# 时间银行 - 产品需求文档 (PRD)

**文档版本：** v1.0  
**创建日期：** 2026-01-05  
**创建者：** Claude Code

---

## 1. 产品概述

### 1.1 产品定位
时间银行是一款帮助用户管理应用使用时长的Android离线工具。通过"时间兑换"机制，鼓励用户使用正向应用（学习、阅读类）来获取使用负向应用（娱乐、社交类）的时间额度，从而培养良好的手机使用习惯。

### 1.2 核心价值
- **行为引导：** 通过正向激励机制引导用户合理分配时间
- **自我管理：** 用户自主设定应用分类和兑换规则
- **隐私保护：** 完全离线运行，数据不上传
- **简洁高效：** 轻量级应用，低资源占用

### 1.3 目标用户
- 希望减少娱乐应用使用时间的学生群体
- 需要提升工作效率的职场人士
- 关注子女手机使用习惯的家长
- 追求自我管理和时间规划的用户

---

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 应用分类管理
**功能描述：** 用户可以将手机上的应用分类为"正向应用"和"负向应用"

**需求细节：**
- 支持从已安装应用列表中选择
- 支持搜索应用名称快速定位
- 支持拖拽调整分类（正向 ↔ 负向）
- 默认提供常见应用的预设分类建议
- 同一应用只能属于一种分类或不分类

**交互规则：**
- 新安装的应用默认为"未分类"状态，不参与时间统计
- 系统应用（设置、电话等）不显示在列表中
- 分类变更立即生效，不影响历史数据

#### 2.1.2 时间统计与积累
**功能描述：** 自动统计用户使用正向和负向应用的时长

**需求细节：**
- 后台实时监控应用使用情况（精度：秒级）
- 使用正向应用积累"时间信用额度"
- 使用负向应用消耗"时间信用额度"
- 显示当前可用额度余额
- 显示今日/本周的正向和负向应用使用时长

**统计规则：**
- 应用在前台运行时才计时
- 切换到其他应用或锁屏时暂停计时
- 短暂切换（<3秒）不记录
- 每小时自动保存数据到本地数据库

#### 2.1.3 时间兑换机制
**功能描述：** 将正向应用使用时长转换为负向应用使用权限

**兑换规则：**
- 默认兑换比例：1:1（使用1分钟正向app = 获得1分钟负向app使用权）
- 用户可调整兑换比例（范围：1:0.1 ~ 1:1）
- 示例：设置为1:0.5时，使用2分钟正向app才能换取1分钟负向app使用权
- 额度实时计算，无需手动兑换操作

**余额管理：**
- 初始余额为0分钟
- 余额可累积，无上限
- 余额不足时无法启动负向应用
- 余额显示格式：小时:分钟（如 2:35）

#### 2.1.4 负向应用拦截
**功能描述：** 当时间余额不足时，阻止用户启动或继续使用负向应用

**拦截策略：**
- 检测到负向应用启动时，检查余额
- 余额不足时立即显示全屏拦截页面
- 使用中实时监控余额，耗尽立即拦截
- 拦截页面无法轻易绕过（无"再玩5分钟"按钮）

**拦截页面内容：**
- 显示当前余额（0分钟）
- 显示今日正向应用使用时长
- 提示如何获取更多时间
- 提供按钮：返回桌面 / 查看正向应用列表
- 显示激励文案："再坚持一下，你可以的！"

**技术实现：**
- 使用UsageStatsManager检测应用切换
- 配合AccessibilityService实现快速响应
- 拦截Activity使用FLAG_ACTIVITY_NEW_TASK覆盖目标应用

#### 2.1.5 数据重置功能
**功能描述：** 定期清空使用时长统计数据，开始新的周期

**重置规则：**
- 默认每周重置一次（每周一 00:00）
- 用户可自定义重置日期和时间
- 重置内容：
  - ✓ 清空所有应用的使用时长记录
  - ✓ 清空时间信用额度余额
  - ✗ 保留应用分类配置
  - ✗ 保留兑换比例设置

**重置方式：**
- 自动重置：到达设定时间自动执行
- 手动重置：用户主动触发（每周仅限1次）
- 重置前弹窗确认，防止误操作
- 重置后显示通知提醒用户

### 2.2 辅助功能

#### 2.2.1 使用记录查询
**功能描述：** 查看历史使用数据和趋势分析

**数据展示：**
- 今日数据：正向/负向应用使用时长、余额变化曲线
- 本周数据：每日对比柱状图、总计时长
- 应用排行：使用时长Top 5的应用
- 趋势分析：本周 vs 上周对比

#### 2.2.2 设置与配置
**功能描述：** 个性化调整应用行为

**设置项：**
- 兑换比例调整（1:0.1 ~ 1:1，步长0.1）
- 重置周期设置（每周特定日期 + 时间）
- 通知开关（余额不足提醒、重置提醒）
- 监控服务开关（启用/暂停监控）
- 数据导出（CSV格式，用于备份）
- 关于页面（版本信息、使用帮助）

#### 2.2.3 引导与帮助
**功能描述：** 首次使用时的引导流程

**引导步骤：**
1. 欢迎页 - 介绍应用核心理念
2. 权限申请 - 引导开启使用统计权限
3. 应用分类 - 初始化正向和负向应用列表
4. 规则设定 - 设置兑换比例和重置周期
5. 完成引导 - 开始监控

---

## 3. 非功能需求

### 3.1 性能要求
- 后台服务CPU占用 < 1%
- 内存占用 < 50MB
- 电池消耗 < 2% / 天
- 应用启动时间 < 1秒
- 拦截响应时间 < 500ms

### 3.2 兼容性要求
- 最低支持Android 8.0（API 26）
- 目标Android 14（API 34）
- 适配主流国产ROM（MIUI、ColorOS、HarmonyOS等）

### 3.3 安全与隐私
- 完全离线运行，不联网
- 不收集用户数据
- 不请求与功能无关的权限
- 数据存储使用加密（SQLCipher）
- 支持应用锁（可选指纹/密码验证）

### 3.4 可维护性
- 代码使用Kotlin编写，遵循Google官方规范
- 采用MVVM架构，模块化设计
- 关键逻辑添加单元测试（覆盖率 > 60%）
- 详细的代码注释（中文）

---

## 4. 用户故事

### 故事1：学生用户
**角色：** 高中生小明  
**场景：** 小明经常在学习时忍不住刷短视频，导致作业拖延  
**需求：** 希望通过强制手段控制娱乐时间  
**解决方案：** 
1. 将学习类App（网易云课堂、作业帮）设为正向应用
2. 将娱乐类App（抖音、王者荣耀）设为负向应用
3. 设置兑换比例为1:0.5（学习2分钟才能玩1分钟）
4. 每周一重置，开始新的挑战

### 故事2：职场用户
**角色：** 程序员小李  
**场景：** 工作时总是被社交软件打断，效率低下  
**需求：** 需要专注工作时间  
**解决方案：**
1. 将工作工具（IDE、Git、Slack）设为正向应用
2. 将社交娱乐（微信朋友圈、微博）设为负向应用
3. 工作日使用，周末不限制
4. 通过数据统计查看专注时长趋势

---

## 5. 业务规则

### 5.1 时间计算规则
- 计时单位：秒（显示时转换为分钟）
- 向下取整：59秒显示为0分钟
- 跨天不重置：余额持续累积到周期结束

### 5.2 拦截逻辑规则
```
IF 检测到负向应用启动 THEN
    IF 当前余额 > 0 THEN
        允许使用，开始扣减余额
        每秒检查余额，归零时立即拦截
    ELSE
        立即显示拦截页面
        阻止进入应用
    END IF
END IF
```

### 5.3 边界条件处理
- **应用同时属于两类：** 不允许，强制用户选择唯一分类
- **余额为负数：** 不允许，最小值为0
- **重置周期重叠：** 以最后设置的为准
- **监控服务被杀：** 自动重启，利用JobScheduler保活
- **时间回拨：** 检测系统时间异常，暂停统计并提示用户

---

## 6. 约束与限制

### 6.1 技术限制
- **无法完全阻止应用启动：** Android系统限制，只能启动后快速覆盖
- **省电模式影响：** 可能被系统限制后台活动，需引导用户加白名单
- **权限依赖：** 核心功能依赖使用统计权限，用户拒绝则无法工作

### 6.2 使用场景限制
- 仅适用于单用户设备（不支持多账号）
- 需要Root权限才能实现真正的"物理阻止"（本版本不实现）
- 无法限制系统级应用（如浏览器中的网页游戏）

---

## 7. 未来规划

### v1.0（当前版本）
- ✓ 核心时间银行功能
- ✓ 基础统计与拦截
- ✓ 离线运行

### v1.1（下一版本）
- 家长控制模式（密码保护设置）
- 更丰富的统计图表
- 成就系统（连续坚持徽章）

### v2.0（远期规划）
- 跨设备同步（可选云端备份）
- 社区分享（匿名的使用习惯对比）
- AI推荐（智能建议应用分类）

---

## 8. 附录

### 8.1 术语表
- **正向应用：** 用户认为有益的应用（学习、工作、阅读类）
- **负向应用：** 用户希望控制使用时长的应用（娱乐、游戏、社交类）
- **时间信用额度：** 通过使用正向应用积累的虚拟"货币"，用于兑换负向应用使用权
- **兑换比例：** 正向应用时长转换为负向应用时长的比例
- **重置周期：** 清空统计数据的时间间隔

### 8.2 参考资料
- [Android UsageStatsManager文档](https://developer.android.com/reference/android/app/usage/UsageStatsManager)
- [Android AccessibilityService指南](https://developer.android.com/guide/topics/ui/accessibility/service)
- [数字健康最佳实践](https://www.android.com/digital-wellbeing/)

### 8.3 文档变更历史
| 版本 | 日期 | 修改内容 | 修改人 |
|------|------|----------|--------|
| v1.0 | 2026-01-05 | 初始版本创建 | Claude Code |

---

**文档结束**

# 时间银行 - 核心功能验证指南

**测试日期**: 2026-01-06  
**设备**: 三星 S24U (R5CY91HSMEB), Android 16  
**APK**: app-debug.apk (11:36 构建)

---

## 📋 验证准备清单

### ✅ 已完成
- [x] 设备通过 ADB 连接
- [x] APK 已构建 (12.4 MB)
- [x] 应用列表加载测试通过 (125个应用)
- [x] 监控服务启动测试通过
- [x] 应用分类功能测试通过 (3个应用)

### ⏳ 待验证
- [ ] 拦截功能（核心）
- [ ] 余额重置功能
- [ ] 悬浮窗权限检查
- [ ] 完整的端到端流程

---

## 🎯 核心功能验证：拦截测试

### 测试目标
验证当时间余额为 0 时，打开负向应用会被立即拦截。

### 前置条件检查

**步骤 1: 打开时间银行应用**
```
在手机上找到并打开"时间银行" App
```

**步骤 2: 检查权限状态（主页标签）**

在"主页"中查看权限卡片，确保显示:
- ✅ 使用统计权限: 已开启
- ✅ 悬浮窗权限: 已开启  
- ✅ 通知权限: 已开启

如果任何权限未开启:
1. 点击对应卡片
2. 在系统设置中授予权限
3. 返回应用验证

**步骤 3: 确认已有负向应用**

1. 切换到"分类"标签
2. 点击"负向应用"子标签
3. 确认列表中至少有 1 个应用

如果没有:
1. 点击"未分类"标签
2. 找到一个娱乐应用（如 Chrome、抖音、YouTube 等）
3. 点击该应用，在弹出菜单中选择"负向应用"
4. 确认已添加成功

**步骤 4: 重置余额为 0**

1. 切换到"设置"标签
2. 找到"重置余额"卡片
3. 点击"重置余额"按钮
4. 在弹窗中点击"确认"
5. 验证余额显示为"0小时 0分钟"

**步骤 5: 确认监控服务运行**

1. 在"设置"标签查看"后台监控服务"
2. 确保开关为"开启"状态
3. 下拉通知栏，应看到"时间银行正在运行"通知

---

### 🧪 执行拦截测试

**操作步骤**:

1. **退出应用**
   - 按 Home 键返回桌面
   - 或按返回键完全退出

2. **打开负向应用**
   - 从桌面或应用抽屉打开刚才添加的负向应用
   - 例如: Chrome 浏览器

3. **观察拦截效果**

---

### ✅ 预期正确结果

**应该看到**:

1. 负向应用的启动画面短暂显示（<1秒）
2. **立即**弹出全屏拦截界面，包含:
   - ⚠️ 橙色警告图标
   - **"时间余额不足"** 红色标题
   - **"无法打开 [应用名]"** 提示
   - **当前余额: 0小时 0分钟** 显示
   - 💡 提示卡片："如何获得时间余额？"
   - **"我知道了"** 蓝色按钮

3. 点击"我知道了"按钮后返回桌面

**界面参考**:
```
┌────────────────────────────┐
│                            │
│          ⚠️                │
│                            │
│     时间余额不足            │
│                            │
│   无法打开 Chrome           │
│ 使用负向应用需要消耗时间余额 │
│                            │
│   ┌─────────────────┐      │
│   │   当前余额       │      │
│   │  0小时 0分钟     │      │
│   └─────────────────┘      │
│                            │
│   ┌─────────────────┐      │
│   │ 💡 如何获得时间余额？│   │
│   │ 使用正向应用可以  │      │
│   │ 获得时间余额      │      │
│   └─────────────────┘      │
│                            │
│   ┌─────────────────┐      │
│   │   我知道了       │      │
│   └─────────────────┘      │
│                            │
└────────────────────────────┘
```

---

### ❌ 如果拦截没有生效

**问题排查流程**:

#### 问题 1: 没有弹出拦截界面

**检查项**:
- [ ] 余额是否真的为 0？
  - 返回时间银行 → 主页/设置查看
- [ ] 应用是否真的分类为负向？
  - 分类 → 负向应用 → 确认列表中有该应用
- [ ] 悬浮窗权限是否开启？
  - 主页 → 权限卡片 → 悬浮窗权限: 已开启
- [ ] 监控服务是否在运行？
  - 通知栏查看"时间银行正在运行"
  - 设置 → 后台监控服务: 开启

**手动授权悬浮窗权限**:
```
手机设置 
→ 应用 
→ 时间银行 
→ 权限 
→ 显示在其他应用上层 
→ 允许
```

#### 问题 2: 拦截延迟超过 2 秒

**可能原因**:
- 监控服务被系统限制
- 设备性能问题

**解决方案**:
```
手机设置 
→ 电池 
→ 应用耗电管理 
→ 时间银行 
→ 不限制
```

#### 问题 3: 拦截后仍可使用应用

**这是正常的**:
- Android 系统限制，无法完全阻止应用启动
- 只能在启动后快速覆盖显示拦截界面
- 用户点击"我知道了"后会返回桌面

---

## 📊 测试结果记录

### 测试项目清单

| 功能模块 | 测试项 | 预期结果 | 实际结果 | 状态 |
|---------|--------|---------|---------|------|
| **权限检查** | 使用统计权限 | 已授予 | | ⏳ |
| | 悬浮窗权限 | 已授予 | | ⏳ |
| | 通知权限 | 已授予 | | ⏳ |
| **应用分类** | 查看负向应用列表 | ≥1个应用 | | ⏳ |
| **余额管理** | 重置余额为0 | 显示"0小时 0分钟" | | ⏳ |
| **监控服务** | 服务运行状态 | 通知栏显示运行中 | | ⏳ |
| **拦截功能** | 打开负向应用 | <1秒弹出拦截界面 | | ⏳ |
| | 拦截界面显示 | 完整信息显示 | | ⏳ |
| | 关闭拦截界面 | 返回桌面 | | ⏳ |

### 性能指标记录

| 指标 | 目标值 | 实测值 | 备注 |
|------|--------|--------|------|
| 拦截响应时间 | <500ms | | 从启动到拦截界面显示 |
| 拦截界面完整性 | 100% | | 所有元素正常显示 |

---

## 🔍 高级测试（可选）

### 测试场景 1: 余额充足时的正常使用

**步骤**:
1. 添加一个正向应用（如"设置"）
2. 使用正向应用 1-2 分钟
3. 返回主页查看余额（应该 >0）
4. 打开负向应用
5. **预期**: 可以正常使用，余额开始扣减

### 测试场景 2: 使用中余额耗尽

**步骤**:
1. 设置余额为 1 分钟（使用正向应用 1 分钟）
2. 打开负向应用
3. 使用 1 分钟后
4. **预期**: 余额耗尽时立即弹出拦截界面

### 测试场景 3: 多个负向应用切换

**步骤**:
1. 添加 2-3 个负向应用
2. 余额设为 0
3. 依次尝试打开这些应用
4. **预期**: 每个都会被拦截

---

## 📝 验证报告模板

**测试人**: _______  
**测试时间**: 2026-01-06 ____:____  
**测试设备**: 三星 S24U

### 测试结果

**✅ 拦截功能是否生效？**  
- [ ] 是，完全符合预期
- [ ] 部分生效（描述问题）: _________________
- [ ] 否，没有拦截（描述现象）: _________________

**拦截响应时间**: _______ 毫秒/秒

**遇到的问题**:
1. _______________________________
2. _______________________________
3. _______________________________

**建议改进**:
1. _______________________________
2. _______________________________
3. _______________________________

---

## 🎉 验证完成标准

当以下所有项都打勾时，核心功能验证通过:

- [ ] 应用成功安装并启动
- [ ] 所有必需权限已授予
- [ ] 监控服务正常运行（通知栏可见）
- [ ] 至少添加了 1 个负向应用
- [ ] 余额成功重置为 0
- [ ] 打开负向应用时立即弹出拦截界面（<1秒）
- [ ] 拦截界面显示完整（标题、余额、提示、按钮）
- [ ] 点击"我知道了"可以关闭拦截界面

---

## 📞 反馈通道

如果测试过程中遇到问题，请记录:
1. 具体操作步骤
2. 预期结果 vs 实际结果
3. 截图或屏幕录制（如果可能）
4. 设备型号和系统版本

---

**文档版本**: v1.0  
**最后更新**: 2026-01-06 14:15  
**创建者**: Claude Code
